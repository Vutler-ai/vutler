# Vutler App Audit â€” 2026-02-26

## âœ… Ce qui marche
| Route/Page | Status |
|-----------|--------|
| GET /api/v1/health | âœ… OK |
| GET /api/v1/providers | âœ… OK (vide) |
| GET /api/v1/settings | âœ… OK (vide) |
| GET /api/v1/dashboard | âœ… OK (stats Ã  0 car getMongoDb fail silently) |
| GET /api/v1/tasks | âœ… OK (2 tasks) |
| GET /api/v1/calendar/events | âœ… OK (1 event) |
| GET /api/v1/email | âœ… OK (vide) |
| GET /api/v1/agents | âœ… OK (13 agents via MongoDB) |
| GET /api/v1/memory/jarvis | âœ… OK (1 memory) |
| POST /api/v1/memory | âœ… OK |
| POST /api/v1/tools/web-search | âœ… OK (Brave) |
| POST /api/v1/tools/shell-exec | âœ… OK (sandboxed) |
| GET /api/v1/templates | âœ… OK (2 templates) |
| POST /api/llm/validate | âœ… OK |
| GET /api/v1/ws/stats | âœ… OK |
| POST /api/v1/auth/login | âœ… OK (validates input) |
| All 11 admin pages | âœ… 200 |
| All 9 landing pages | âœ… 200 |

## âŒ Ce qui ne marche PAS
| Route | Erreur | Cause | Fix |
|-------|--------|-------|-----|
| POST /api/llm/route | Cannot POST | Route montÃ©e aprÃ¨s module.exports, mais les routes dans llm-router.js n'exposent pas /route | VÃ©rifier les routes internes de llm-router.js |
| GET /api/agents (runtime) | Cannot GET | agentRuntime montÃ© sur /api/agents mais paths internes ne matchent pas | Fix path matching |
| POST /api/agents/:id/start | "Database not available" | `req.app.locals.pg` est undefined â€” jamais set dans index.js | Ajouter `app.locals.pg = pool` dans index.js |
| POST /api/v1/email/send | Cannot POST | Route email est POST / (root), pas /send | Frontend doit appeler POST /api/v1/email, pas /api/v1/email/send |
| GET /api/v1/calendar | Cannot GET | Route est /events, pas root | Frontend doit appeler /api/v1/calendar/events |

## âš ï¸ Marche partiellement
| Route | Issue |
|-------|-------|
| GET /api/v1/dashboard | Retourne tout Ã  0 â€” `getMongoDb()` undefined dans dashboard.js (4 appels). Stats agents/messages/tokens toujours 0 |
| GET /api/v1/agents | Marche (MongoDB) mais le frontend admin/agents.html appelle peut-Ãªtre le mauvais endpoint |

## ğŸ”§ Fixes nÃ©cessaires (prioritÃ©)

### P0 â€” Critique
1. **dashboard.js** â€” Remplacer `getMongoDb()` par `req.app.locals.db` (MongoDB est dans app.locals.db depuis index.js)
2. **agent-runtime.js** â€” Ajouter `app.locals.pg = require('./lib/vaultbrix')` dans index.js pour que le runtime ait accÃ¨s Ã  PG
3. **admin/agents.html** â€” VÃ©rifier que fetch() pointe vers /api/v1/agents

### P1 â€” Important
4. **email routes** â€” Le frontend (admin) doit utiliser POST /api/v1/email (pas /email/send)
5. **calendar routes** â€” Frontend doit utiliser /api/v1/calendar/events
6. **LLM Router** â€” VÃ©rifier les routes internes de llm-router.js et les paths

### P2 â€” Nice to have
7. **Settings** â€” Retourne vide (pas de settings initiaux)
8. **Providers** â€” Retourne vide (personne n'a encore configurÃ© via wizard)
